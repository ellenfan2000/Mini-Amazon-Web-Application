{% extends "Amazon/index.html" %}
{% block content %}
{% if messages %}
{% for message in messages %}
<div class="container-fluid p-0">
    <div class="alert {{ message.tags }} alert-dismissible" role="alert">
        {{ message }}
    </div>
</div>
{% endfor %}
{% endif %}
{%if user.is_authenticated%}
<div class="col-8">
    
    
    <p>Welcome, {{user.username}} ! We are happy to Serve you!</p>
    <br>
    
    <caption><h3>Recommended Products</h3></caption> 
    <table class="table table-striped table-hover caption-top">
        <tr>
            <th style="width:28%"></th> 
            <th style="width:20%" >Average Rate</th> 
            <th style="width:20%"></th> 
        </tr>   
        {% for r in recommends %} 
            <tr>
                <td>
                    {{r.name}}
                </td>
                <td class="rate" >
                    {{r.avg_rate}}
                </td>
                <td>
                    <a href="{% url 'product_details' r.id %}">Details</a>
                    
                </td>
            </tr>
        {% endfor %}
    </table>
    <script>
        let cells = document.querySelectorAll(".rate");
        cells.forEach(cell => {
            let content = cell.textContent.trim();
            if(content!=""){
                cell.textContent=content.substring(0,4);
            }            
        });
    </script>
    {%else%}
    <h3>
        <p>Welcome to Mini Amazon!</p>
    </h3>
    <p>We are happy to Serve you!</p>
    <p>If you already have an account <a href="/login">Log in here</a>.</p>
    <p>Or, <a href="/register">Register a new account here</a>.</p>
    {%endif%}
</div>

{% endblock %}